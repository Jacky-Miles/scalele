<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Today's Musical Scale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; background: #f7f7fa; margin: 0; padding: 2em;}
    h1 { text-align: center; }
    .scale-box { margin: 2em auto; max-width: 400px; background: #fff; border-radius: 1em; box-shadow: 0 2px 8px #aaa3; padding: 2em; text-align: center; }
    .scale-today { font-size: 2em; color: #336; margin: 1em 0; }
    .scale-yesterday { font-size: 1.2em; color: #666; margin: 0.5em 0 1em; }
    .label { font-weight: bold; color: #555; }
  </style>
</head>
<body>
  <h1>Musical Scale of the Day</h1>
  <div class="scale-box" id="scales"></div>
<script>
const ROOTS = ["A", "Ab", "B", "Bb", "C", "C#", "D", "Db", "E", "Eb", "F", "F#", "G", "Gb"];
const TYPES = ["Natural", "Melodic Minor", "Harmonic Minor"];
const ALL_SCALES = [];
ROOTS.forEach(root => TYPES.forEach(type => ALL_SCALES.push(`${root} ${type}`)));

// Deterministic pseudo-random number generator (Mulberry32)
function mulberry32(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };
}

// Hash function to turn a date string into a seed
function hashDate(str) {
  let h = 2166136261 >>> 0;
  for (let i = 0; i < str.length; i++) {
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}

// For each day, pick a scale not used in the last 7 days
function scaleForDay(dayOffset, startDate, calendarCache) {
  // dayOffset: 0 = today, -1 = yesterday, etc.
  let date = new Date(startDate);
  date.setDate(date.getDate() + dayOffset);
  let dateStr = date.toISOString().slice(0,10);
  if (calendarCache[dateStr]) return calendarCache[dateStr];

  // Build recent scales (past 7 days excluding this one)
  let recent = [];
  for (let i = 1; i <= 7; i++) {
    let prevDate = new Date(date);
    prevDate.setDate(prevDate.getDate() - i);
    let prevStr = prevDate.toISOString().slice(0,10);
    if (calendarCache[prevStr]) recent.push(calendarCache[prevStr]);
  }

  let seed = hashDate(dateStr + "-fixed-seed");
  let rng = mulberry32(seed);
  let eligible = ALL_SCALES.filter(s => !recent.includes(s));
  let pick = eligible[Math.floor(rng() * eligible.length)];
  calendarCache[dateStr] = pick;
  return pick;
}

// UTC today
const now = new Date();
const todayUTC = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));

let calendarCache = {};
let todayScale = scaleForDay(0, todayUTC, calendarCache);
let yesterdayScale = scaleForDay(-1, todayUTC, calendarCache);

let html = `<div>
  <span class="label">Today</span>
  <div class="scale-today">${todayScale}</div>
</div>`;

if (yesterdayScale) {
  html += `<div>
    <span class="label">Yesterday</span>
    <div class="scale-yesterday">${yesterdayScale}</div>
  </div>`;
}

document.getElementById("scales").innerHTML = html;
</script>
</body>
</html>
